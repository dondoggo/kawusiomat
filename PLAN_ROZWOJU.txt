================================================================================
  KAWUSIOMAT - PLAN ROZWOJU, UTRZYMANIA I DOKUMENTACJA
================================================================================

Data utworzenia: 2026-02-12
Ostatnia aktualizacja: 2026-02-26
Wersja aplikacji: 1.2
Stack: HTML + CSS + vanilla JavaScript ES6+ (bez frameworkow)
Linter: ESLint 10 (eslint.config.mjs)
Hosting: GitHub Pages (static.yml)

================================================================================
  1. OPIS APLIKACJI
================================================================================

Kawusiomat to kreator przepisow do kawy z French Pressa.
Uzytkownik przechodzi przez 4-krokowy wizard:

  Krok 1 — Liczba filizanek (1-6)
  Krok 2 — Pojemnosc kazdej filizanki (150-350 ml)
  Krok 3 — Rodzaj kawy (czarna, americano, cappuccino, flat white, latte)
  Krok 4 — Moc kawy (slaba, srednia, mocna)

Wynik: szczegolowy przepis z krokami, proporcjami, bloomingiem,
spienianiem mleka i poradami. Dziala offline (PWA).

================================================================================
  2. STRUKTURA PLIKOW
================================================================================

  kawusiomat/
  ├── index.html          Glowny plik HTML (wizard + recipe + timer)
  ├── style.css           Style (responsywne, mobile-first)
  ├── app.js              Logika aplikacji (ES6+ IIFE, bez zaleznosci)
  ├── manifest.json       PWA manifest (nazwa, ikona, kolory, standalone)
  ├── sw.js               Service Worker (cache-first, offline)
  ├── icon.svg            Ikona aplikacji (PWA, apple-touch-icon)
  ├── eslint.config.mjs   Konfiguracja ESLint (flat config)
  ├── package.json        npm — devDependencies: eslint
  ├── .github/
  │   └── workflows/
  │       └── static.yml  Deploy na GitHub Pages
  └── PLAN_ROZWOJU.txt    Ten plik

================================================================================
  3. PLAN ROZWOJU — NOWE FUNKCJONALNOSCI
================================================================================

--- PRIORYTET WYSOKI ---

[x] Timer parzenia (zrealizowano 2026-02-12)
    - Odliczanie czasu parzenia po wygenerowaniu przepisu
    - Dzwiek (Web Audio API) i wibracja po zakonczeniu kazdej fazy
    - Osobny timer na blooming (30 sek) i glowne parzenie
    - Kolowy SVG ring z postepem, start/pauza/reset, animacja pulsowania

[x] Zapisywanie ulubionych przepisow (localStorage) (zrealizowano 2026-02-26)
    - Przycisk "Zapisz przepis" na ekranie wyniku
    - Lista zapisanych przepisow (accordion) dostepna z ekranu glownego
    - Mozliwosc usuwania zapisanych przepisow
    - Toast notification po zapisaniu, max 20 przepisow

[x] Tryb offline (PWA) (zrealizowano 2026-02-26)
    - Manifest.json + Service Worker (cache-first)
    - Mozliwosc instalacji na telefonie (beforeinstallprompt)
    - Pelna funkcjonalnosc bez internetu
    UWAGA: przy kazdym deploy na GitHub Pages naley zbumpowac
    CACHE_NAME w sw.js (np. kawusiomat-v2, v3...) aby uzytkownicy
    dostali nowe pliki — bez tego SW serwuje stary cache!

[ ] Tryb ciemny
    - Przelacznik jasny/ciemny w naglowku
    - Respektowanie preferencji systemowych (prefers-color-scheme)
    - Zapisanie wyboru w localStorage

[ ] Powtorz ostatni przepis (1 klikniecie)
    - Przycisk "Parze znowu" na ekranie przepisu — resetuje timer
      i ponownie pokazuje ten sam przepis bez przechodzenia przez wizard
    - Alternatywnie: "Ostatnio parzona" jako skrot na ekranie glownym
      jesli uzytkownik zamknal aplikacje miedzy parzeniami
    Uzasadnienie: najczestszy use case to powtarzanie tej samej kawy
    rano. Przejscie przez 4 kroki wizarda jest redundantne.

--- PRIORYTET SREDNI ---

[ ] Udostepnianie przepisu
    - Przycisk "Udostepnij" generujacy link z parametrami w URL
      (np. ?cups=1&size=250&type=czarna&strength=medium)
    - Kopiowanie przepisu jako tekst do schowka
    - Web Share API na urzadzeniach mobilnych (navigator.share)

[ ] Zmiana nazwy ulubionego przepisu
    - Inline edit po kliknieciu w nazwe przepisu na liscie ulubionych
    - Domyslna nazwa generowana automatycznie, ale uzytkownik moze
      nadac swoja (np. "Poranna mocna", "Dla gosci")
    - Zapis w tym samym obiekcie w localStorage

[ ] Potwierdzenie usuwania ulubionego
    - Zamiast natychmiastowego usuniecia: inline "Usunac? Tak / Nie"
    - Lub przycisk "Cofnij" w tostcie przez 5 sekund (undo pattern)

[ ] Customizable czas parzenia
    - Mozliwosc nadpisania domyslnego czasu (3/4/5 min) przez uzytkownika
    - Przyciski +/- lub suwak na ekranie kroku 4 lub bezposrednio
      w sekcji timera na ekranie przepisu
    - Preferencja zapisana w ulubionym jesli uzytkownik zapisuje przepis

--- PRIORYTET NISKI ---

[ ] Wielojezycznosc (i18n)
    - Polski (domyslny), angielski
    - Slownik poza kodem (obiekt/JSON)
    - Przelacznik jezyka w naglowku

[ ] Historia parzen
    - Automatyczne logowanie kazdego wygenerowanego przepisu z data
    - Statystyki: ile kaw zaparzono, ulubiony rodzaj, srednia moc
    - Prosta lista z datami (nie wymaga backendu — localStorage)

[x] Animacje i mikrointerakcje (zrealizowano 2026-02-12)
    - Animacja parzenia kawy (pour + fill + steam) na ekranie przepisu
    - Plynne przejscia miedzy krokami wizarda (fade + slide up)
    - Bounce na progress dots przy zmianie kroku
    - Pop na przyciskach przy zaznaczeniu (button-group)
    - Staggerowane wejscie: summary items, cup configs, steps, info bars
    - Bounce na checkboxie krokow przy zaznaczeniu "done"

[ ] Kalkulator kosztow
    - Cena za kg kawy i litr mleka (wpisywane przez uzytkownika)
    - Obliczanie kosztu jednej filizanki
    - Porownanie z kawiarnia (srednia cena kawy w Polsce ~15 zl)

[ ] Eksport / Import ulubionych (JSON)
    - Przycisk "Eksportuj" pobiera plik kawusiomat-favorites.json
    - Przycisk "Importuj" wczytuje plik i scala z istniejacymi
    - Umozliwia backup i przeniesienie na inne urzadzenie

[ ] Sugestia rozmiaru French Pressa
    - Na podstawie totalBaseWater pokaz jaki French Press jest potrzebny:
      300 ml / 500 ml / 1000 ml (wlaczajac zapas na fusy i piane)
    - Maly diagram lub chip w sekcji summary

================================================================================
  4. PLAN UTRZYMANIA
================================================================================

--- JAKOSC KODU ---

[x] Migracja na ES6+ (zrealizowano 2026-02-12)
    - var → const/let, function → arrow, konkatenacja → template literals
    - for+var IIFE → for+let (block scope eliminuje bledy closure)
    - for...of, .forEach(), .some(), .map(), shorthand properties

[x] Linter (ESLint) (zrealizowano 2026-02-12)
    - Flat config: eslint.config.mjs (ESLint 10)
    - Reguly: no-var, prefer-const, prefer-template, eqeqeq, no-eval
    - Skrypty npm: "npm run lint" / "npm run lint:fix"
    - 0 errors, 0 warnings na aktualnym kodzie

[ ] Formatter (Prettier)
    - Spojny styl kodu
    - Konfiguracja .prettierrc

[ ] Testy
    - Testy jednostkowe logiki (calculateRecipe, generateSteps)
    - Framework: Vitest lub Jest
    - Testy E2E: Playwright lub Cypress (przejscie przez wizard)

--- CI/CD ---

[ ] GitHub Actions
    - Lint przy kazdym PUSH i PR
    - Testy automatyczne
    - Deploy na GitHub Pages (juz istnieje: static.yml)

[ ] Wersjonowanie
    - Semantic versioning (MAJOR.MINOR.PATCH)
    - Changelog (CHANGELOG.md) przy wiekszych zmianach
    - Git tags dla wersji
    - Automatyczne bump CACHE_NAME w sw.js jako czesc procesu release

--- WYDAJNOSC ---

[ ] Minifikacja CSS i JS (np. esbuild, terser)
[ ] Audit Lighthouse — cel: 100/100 we wszystkich kategoriach
    Aktualny status po dodaniu PWA: do sprawdzenia (manifest OK,
    SW OK, brak ikony maskable moze obnizac score)

--- DOSTEPNOSC (a11y) ---

[ ] Atrybuty ARIA dla przyciskow-radio (role="radiogroup", aria-checked)
[ ] Obsluga klawiatury (nawigacja Tab + Enter/Space)
[ ] Kontrasty kolorow zgodne z WCAG 2.1 AA
[ ] Skip-to-content link
[ ] Label dla kazdej grupy przyciskow

--- BEZPIECZENSTWO ---

[ ] Content Security Policy (meta tag lub header)
[ ] Subresource Integrity jesli dodane zostana zewnetrzne zasoby
[ ] Regularne aktualizacje zaleznosci (jesli zostana dodane)

================================================================================
  5. CODE REVIEW — ZNALEZIONE PROBLEMY (do naprawy)
================================================================================

--- BLEDY / DEAD CODE ---

[x] state.currentStep — dead code (naprawiono 2026-02-27)
    - Pole ustawiane w showStep() ale nigdzie nie odczytywane
    - Usunieto z obiektu state i z funkcji showStep

[x] generateSteps() czytalo state.cupCount bezposrednio (naprawiono 2026-02-27)
    - 3 wystapienia zastapione przez recipe.cups.length
    - Eliminuje ukryta zaleznosc od globalnego stanu

[x] Gramatyka PL w generateFavoriteLabel() (naprawiono 2026-02-27)
    - Dodano helper pluralizeCups(n): filizanka / filizanki / filizanek
    - Poprawnie dla 1, 2-4 i 5+ filizanek

[x] Brak deduplikacji przy zapisie ulubionych (naprawiono 2026-02-27)
    - Dodano isSameRecipe(fav): porownuje strength/cupCount/cups
    - Przy probie zapisu duplikatu: toast "Ten przepis jest juz zapisany"

--- DROBNE PROBLEMY ---

[x] timerBeep() tworzylo nowy AudioContext przy kazdym wywolaniu (naprawiono 2026-02-27)
    - Dodano let audioCtx = null z leniwą inicjalizacja
    - AudioContext tworzony raz, reuzywany przy kolejnych dzwiekach

[x] favorites-chevron query w event handlerze (naprawiono 2026-02-27)
    - Dodano const favoritesChevron do sekcji DOM REFS
    - Handler uzywa cached ref zamiast document.getElementById

[x] Kodowanie znakow w app.js — niekonsekwentne (naprawiono 2026-02-27)
    - Polskie znaki i symbole zastapione bezposrednim UTF-8
    - Pozostaly tylko 3 emoji surrogate pairs (\uD83E...) — poprawny JS

--- PWA ---

[ ] Brak ikony maskable dla Android adaptive icons
    - Bez purpose:"maskable" Chrome dodaje biale tlo wokol ikony
    - Stworzyc icon-maskable.svg (ta sama grafika + 10% padding)
    - Dodac wpis do manifest.json z purpose:"maskable"

[ ] Strategia bump CACHE_NAME przy deploy
    - Aktualnie: kawusiomat-v1 — wymaga recznej zmiany
    - Opcja A: skrypt npm "predeploy" bump'ujacy wersje w sw.js
    - Opcja B: sw.js pobiera wersje z meta tagu w index.html
    - Opcja C: uzyc workbox (ale to dodatkowa zaleznosc)

================================================================================
  6. ZNANE BLEDY — NAPRAWIONE
================================================================================

[x] Mozliwosc zaznaczenia wielu rozmiarow w jednej filizance
    - Przyczyna: closure w petli for+var lapalo zmienna 'group'
      przez referencje — po petli wskazywala na ostatnia grupe
    - Naprawiono: migracja na ES6+ let/const
    - Data naprawy: 2026-02-12

[x] Zla ilosc naparu — aplikacja nie uwzgledniala absorpcji wody
    - Przyczyna: totalBaseWater == targetBrewVolume, a fusy
      pochlaniaja ~2 ml wody/g kawy (standard SCA)
    - Efekt: dla 250 ml filiżanki, ratio=14 uzytkownik dostawal
      ~214 ml naparu zamiast 250 ml
    - Naprawiono: waterNeeded = targetBrew * ratio / (ratio - 2)
    - Data naprawy: 2026-02-26

================================================================================
  7. KONWENCJE PROJEKTU
================================================================================

- Jezyk interfejsu: polski
- Nazwy zmiennych i komentarzy w kodzie: angielski
- ES6+ (const/let, arrow functions, template literals, for...of)
- Jedna devDependency: eslint (brak runtime dependencies)
- Pojedynczy plik JS w IIFE (brak modulow — celowa prostota)
- Mobile-first, responsywny CSS
- Brak build stepu — pliki serwowane bezposrednio
- Lint: npm run lint (0 errors wymagane przed commitem)
- PWA: po kazdym deploy zbumpowac CACHE_NAME w sw.js

================================================================================
  8. KONTAKTY I ZASOBY
================================================================================

Repozytorium: GitHub (branch: main)
Deploy: GitHub Pages (automatyczny przez static.yml)
Issue tracker: GitHub Issues

================================================================================
